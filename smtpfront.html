<html>
<body>

<h2><a href="mailfront.html">MailFront</a></h2>

<h1>SMTP Front Ends</h1>

<hr>

<h2>Overview</h2>

<p>The code for SMTP is divided internally into two sections:
front-end and back-end code.  The front-end code handles the low-level
details of the protocol.  The back-end code handles the validation and
delivery details in a protocol-independant fashion.</p>

<h2>Features</h2>

<p>The following features are common to all SMTP front-ends: <ul>

<li>Validates senders and recipients according to <a
href="mailrules.html">mail rules</a> processing.

<li>If <tt>$RELAYCLIENT</tt> is set, all recipient addresses not
rejected by mail rules are allowed, and its contents are appended to
each recipient address.  Back-end validation is omitted.

<li>Handles RFC 2554 SMTP authentication.  After authentication all
recipients not rejected by mail rules are allowed, and back-end
validation is omitted.

<li>Automatically handles either bare NL or RFC 821/2821 compliant
CR/NL end-of-line conventions.

<li>Rejects messages that exceed <tt>$DATABYTES</tt> bytes in the
body.

<li>Times out connections after <tt>$TIMEOUT</tt> seconds of inactivity
(defaults to 1200 seconds or 20 minutes), or <tt>$SESSION_TIMEOUT</tt>
seconds after the connection was established (defaults to 86400 seconds
or 24 hours).

<li>Counts the number of "<tt>Received:</tt>" and
"<tt>Delivered-To:</tt>" headers, and rejects the message if more than
<tt>$MAXHOPS</tt> of either are seen (defaults to 100).

<li>All error responses are logged.

<li>Handles (ignores) RFC 1869 extended parameters on the <tt>RCPT
TO:</tt> and <tt>MAIL FROM:</tt> commands.

<li>Initial greeting message is configureable by
<tt>$SMTPGREETING</tt>.

<li>Rejects bounce messages (messages with an empty envelope sender)
that attempt to deliver to multiple recipients.

<li>Optionally adds a fixup "<tt>Received:</tt>" header for hosts that
have different incoming and outgoing hostnames or IPs.  Set
<tt>$FIXUP_RECEIVED_HOST</tt> and <tt>$FIXUP_RECEIVED_IP</tt> if you
want this header added.

<li>Optional user-specified headers may be added by setting
<tt>$HEADER_ADD</tt>.

<li>If <tt>$CVM_LOOKUP</tt> is set, recipients are sent to the named CVM
to see if they are valid.  If <tt>$LOOKUP_SECRET</tt> is set, its value
is sent as a single credential to the CVM.</tt>

<li>Supports RFC 1870 SMTP Service Extension for Message Size
Declaration.

<li>If <tt>$MAXRCPTS</tt> is set, the number of recipients allowed per
message is limited to that number.</tt>

</ul></p>

<h2>Back Ends</h2>

<dl>

<dt><tt>smtpfront-echo</tt> <dd><p>Uses the echo backend to simply
echo back the sender and recipient parameters, and the size of the
data to the client.</p>

<dt><tt>smtpfront-qmail</tt> <dd><p>Uses the <a
href="qmail-validate.html">qmail validation features</a> to validate
addresses, and the <a href="qmail-backend.html">qmail backend</a> to
deliver messages.</p>

<dt><tt>smtpfront-reject</tt> <dd><p>If <tt>$SMTPREJECT</tt> is set,
all SMTP commands are rejected with this message.  If the message
starts with a "<tt>-</tt>", a permanent error number is used and the
leading "<tt>-</tt>" is stripped.  If <tt>$SMTPREJECT</tt> is not set,
it execs its command line.</p>

</dl>

</body>
</html>
